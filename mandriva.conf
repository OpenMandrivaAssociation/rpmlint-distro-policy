from Config import *
from os import environ

#TODO add a loop for theses errors 
# forbidden-selinux-command-in-
# incorrect-i18n-tag-
# incorrect-locale-
# invalid-shell-in-
# non-empty-
# perl-syntax-error-in-
# shell-syntax-error-in-
# update-menus-without-menu-file-in-
# use-of-home-in-
# use-tmp-in-


for line in open('/usr/share/rpmlint/config.d/mandriva.error.list').readlines():
    vals = line.strip().split(" ")
    errorType = vals[0]
    if len(vals) >= 2:
        if vals[1][0] == 'M':
            if True or environ.has_key("RPMBUILD_MAINTAINER_MODE"):
                #maintMode = environ["RPMBUILD_MAINTAINER_MODE"]
                if True or (maintMode.isdigit() and int(maintMode)):
                    addFilter(errorType)
                    continue
            badness = int(vals[1][1:])
        else:
            badness = int(vals[1])
    else:
        badness = 1
    setBadness(errorType, badness)

setOption('BadnessThreshold', 49)

mdv_valid_group=(
    'Accessibility',
    'Archiving/Backup',
    'Archiving/Cd burning',
    'Archiving/Compression',
    'Archiving/Other',
    'Books/Computer books',
    'Books/Faqs',
    'Books/Howtos',
    'Books/Literature',
    'Books/Other',
    'Communications',
    'Databases',
    'Development/C',
    'Development/C++',
    'Development/Databases',
    'Development/Debug',
    'Development/GNOME and GTK+',
    'Development/Java',
    'Development/KDE and Qt',
    'Development/Kernel',
    'Development/Other',
    'Development/Perl',
    'Development/PHP',
    'Development/Python',
    'Development/Ruby',
    'Development/X11',
    'Editors',
    'Education',
    'Emulators',
    'File tools',
    'Games/Adventure',
    'Games/Arcade',
    'Games/Boards',
    'Games/Cards',
    'Games/Other',
    'Games/Puzzles',
    'Games/Sports',
    'Games/Strategy',
    'Graphical desktop/Enlightenment',
    'Graphical desktop/FVWM based',
    'Graphical desktop/GNOME',
    'Graphical desktop/Icewm',
    'Graphical desktop/KDE',
    'Graphical desktop/Other',
    'Graphical desktop/Sawfish',
    'Graphical desktop/WindowMaker',
    'Graphical desktop/Xfce',
    'Graphics',
    'Monitoring',
    'Networking/Chat',
    'Networking/File transfer',
    'Networking/IRC',
    'Networking/Instant messaging',
    'Networking/Mail',
    'Networking/News',
    'Networking/Other',
    'Networking/Remote access',
    'Networking/WWW',
    'Office',
    'Publishing',
    'Sciences/Astronomy',
    'Sciences/Biology',
    'Sciences/Chemistry',
    'Sciences/Computer science',
    'Sciences/Geosciences',
    'Sciences/Mathematics',
    'Sciences/Other',
    'Sciences/Physics',
    'Shells',
    'Sound',
    'System/Base',
    'System/Cluster',
    'System/Configuration/Boot and Init',
    'System/Configuration/Hardware',
    'System/Configuration/Networking',
    'System/Configuration/Other',
    'System/Configuration/Packaging',
    'System/Configuration/Printing',
    'System/Fonts/Console',
    'System/Fonts/True type',
    'System/Fonts/Type1',
    'System/Fonts/X11 bitmap',
    'System/Internationalization',
    'System/Kernel and hardware',
    'System/Libraries',
    'System/Printing',
    'System/Servers',
    'System/X11',
    'Terminals',
    'Text tools',
    'Toys',
    'Video',
    )

setOption('ValidGroups', mdv_valid_group)
setOption('ForbiddenWords', 'mandrake')

setOption('CompressExtension', 'xz')
setOption('NetworkEnabled', False)
setOption('InstallInfoTriggers', True)

# no longer needed in cooker, we use file trigger
addFilter('.* library-without-ldconfig-postin .*')
addFilter('.* library-without-ldconfig-postun .*')

addFilter('.* hardcoded-library-path in \$RPM_BUILD_ROOT/lib/udev/rules.d/.*')
addFilter('.* hardcoded-library-path in /lib/udev/rules.d/.*')

# we no longer compress patch and source when this is not needed
addFilter('.* source-or-patch-not-compressed .*')

# we do not check url in Source for the moment
addFilter('.* invalid-url .*')

# BuildRoot is optional now in our version of rpm
addFilter('.* no-buildroot-tag')

# false positive, as it has a number in the name
addFilter('.* invalid-build-requires (\(.*\) |)libxml2-devel')

# false positive nowadays, may need a bug rpmlint side
addFilter('.* no-dependency-on (\(.*\) |)python-base')
addFilter('.* no-dependency-on (\(.*\) |)perl-base')

# %clean is now implicit
addFilter('no-%clean-section')

# %defattr(-,root,root) is now default
addFilter('files-attr-not-set')

# cleaning of buildroot is now implicit
addFilter('no-cleaning-of-buildroot')

# unless we have multiple majors we want to link against, we don't want it in name
addFilter('no-major-in-name (\(.*\) |)lib.*-devel')

# -debug package files
addFilter('-debug(info|)\..*: hidden-file-or-dir (\(.*\) |)/usr/lib/debug/.build-id')

# -debug package symlink
addFilter('-debug(info|)\..*: dangling-relative-symlink (\(.*\) |)/usr/lib/debug/.build-id/.*')

addFilter('-debug(info|)\..*: shared-lib-without-dependency-information (\(.*\) |)/usr/lib/debug/.*')

addFilter('-debug(info|)\..*: executable-stack (\(.*\) |)/usr/lib/debug/.build-id/.*')

addFilter('-debug(info|)\..*: statically-linked-binary (\(.*\) |)/usr/lib/debug/.*')

addFilter('-debug(info|)\..*: unstripped-binary-or-object (\(.*\) |)/usr/lib/debug/.*')

addFilter('-debug(info|)\..*: php-naming-policy-not-applied (\(.*\) |)/usr/lib/debug/.*')

addFilter('-debug(info|)\..*: no-documentation')

addFilter('-debug(info|)\..*: hidden-file-or-dir (\(.*\) |)/usr/(lib|src)/debug/.*')

# Requires(pre,post,...) syntax is working fine with any recent rpm version
addFilter('broken-syntax-in-scriptlet-requires')

# this was originally a policy to prevent the necessity of providing more
# than just the relevant sub-package for package updates. It was never put to
# action and likely never will
addFilter('requires-on-release')

addFilter('script-without-shebang (\(.*\) |)/lib/systemd/system/.*.service$')

addFilter('subdir-in-bin (\(.*\) |)/usr/bin/multiarch-.*/.+')
addFilter('dangling-relative-symlink (\(.*\) |).* \.\./\.\./usr/bin/multiarch-dispatch')

# for various ruby packages 
for i in ['%2a','%2b','%2d','%2f','%3c','%3d','%3e','%3f','%5b','%5d','%7c','%7e','%21','%25']:
    addFilter('unexpanded-macro (\(.*\) |)/usr/lib/ruby/gems/.*/doc/.* %s' % i)

# ruby documentation
addFilter('unexpanded-macro (\(.*\) |)/usr/share/ri/')

# we've got better things to do than notifying upstream projects about FSF's address relocation..:p
addFilter('incorrect-fsf-address')

addFilter('hardcoded-library-path (\(.*\) |)in /lib/udev/.*')

addFilter('non-standard-dir-in-usr (\(.*\) |)uclibc')
addFilter("binary-or-shlib-defines-rpath.*\['/usr/uclibc/lib(|64)', '/usr/uclibc/usr/lib(|64)'\]")
addFilter('outside-libdir-files (\(.*\) |)/usr/uclibc/(|usr)/lib(|64)/')

addFilter('useless-provides (\(.*\) |)elf\(buildid\)')

# delay untill all shortcomings has been fixed
addFilter('legacy-mandriva-filetriggers')
